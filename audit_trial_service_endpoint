import { Injectable } from '@angular/core';
import { Http ,Response, Headers } from '@angular/http';

import { ApiServerCallerProvider } from '../api-server-caller/api-server-caller';
import { AuthenticationHandler } from '../authentication-handler/authentication-handler';

@Injectable({
  providedIn: 'root'
})
export class AuditTrailHandlerService {
  loginStatus : boolean = false;
  debugFlag: boolean = false;

  constructor(private apiServerCallProvider : ApiServerCallerProvider, private authenticationHandler : AuthenticationHandler) {


   }


  getAudittrailRoot(page, dataIn,filteredStartDate, filteredEndDate,type){
    let loginStatus = this.authenticationHandler.isLoggedIn();
    let headers = new Headers();
    headers.append("Authorization", loginStatus[2]);
    let url =  "/records/?page="+page+"&size="+dataIn;
    if(filteredStartDate != null && filteredStartDate.length > 0){
      url = url +"&createDateStart="+ filteredStartDate;
    }
    if(filteredEndDate != null && filteredEndDate.length > 0){
      url = url +"&createDateEnd="+ filteredEndDate;
    }
	if (type != null && type.length > 0 && type != "All") {
		url = url +"&type=" + type;
	}
    console.log(url);
    return new Promise<string>(resolve => {
    if(loginStatus[0] == 'true') {
    return this.apiServerCallProvider.get(url,headers,"audittrails").subscribe((data)=>
        { 	console.log(data);
            resolve(JSON.stringify({"returnCode": "true","responseText": "successfully retrieved audit trails for page 1 and size 100.", "data":data}));
              
        },(err)=>{
          resolve(JSON.stringify({"returnCode": "false","responseText": "There seems to be an issue with the server or your internet connection."}));
        });
    }else {
      resolve(JSON.stringify({"returnCode": "false","responseText": "There seems to be an issue with the server or your internet connection."}));
    }
    });
    
  }
}
